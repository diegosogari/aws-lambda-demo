package main

import (
	"testing"

	"github.com/stretchr/testify/assert"
)

func TestValidateAccessToken(t *testing.T) {
	const token = "eyJraWQiOiIwU3pKejlUVzYrUW16cVRtVUFhbWdRMElSQ3BUbjZwTWQ2a0FQR09JN1pvPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJhMjI5M2I0OC05NzQxLTQ1ZDYtOTE3NC03MjE3Yzk2MTMxY2IiLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3VzLWVhc3QtMV96Qm1jOHl0Y0ciLCJ2ZXJzaW9uIjoyLCJjbGllbnRfaWQiOiIxdDJpNmFkYnYwczJiZmswcWY0dXAyNWkxaiIsIm9yaWdpbl9qdGkiOiIzNWI0ZDEzOC01OTJkLTQ5ZmUtYmFjNy1lZjZiYjU2OWEzOTQiLCJldmVudF9pZCI6IjJkMTI3MGE0LTI5OTEtNDU2Yi1iYjMwLTFmYzRkMDc3NDAyYyIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoib3BlbmlkIGVtYWlsIiwiYXV0aF90aW1lIjoxNjk4OTc1MDk5LCJleHAiOjE2OTkwNjY2MzEsImlhdCI6MTY5OTA2MzAzMSwianRpIjoiMGUwZmY1N2QtMjdkYy00NjFhLWE5YmUtODhkYjUxNjg1NTQxIiwidXNlcm5hbWUiOiJhMjI5M2I0OC05NzQxLTQ1ZDYtOTE3NC03MjE3Yzk2MTMxY2IifQ.vgzlHILA3-hAXCuFrUqYqU-qWXWLIpmBjYuoiBhW59rAih7Jk2qfmnVklQ6UBymIqvTixCSMdM4OZZB5il0M4woozpJ_OTqdJDVdzAkLAf62nGR--lIWNwEauUN2nezsxQd_BNNNI4bfS-5NWJNqeM96AmCFd9B-E8LYAHKcY47BojjAGXrTdLsRUn7WIbGQmB3sZZ-ZI3274BdUrfW__-YE-a0RtEZAY8rdzkv5huZLyTeH-0QtDxDNOjnRQQ29uQl8YRss3EMDWRbDN6hhw_YnaYqF6N_dUwoR3fjXAHbecPD9uj0IqR4ZKpHekHIIWDM_RJZhMrSB1iPdaCGxmg"
	_, err := validateToken(token, jwks.Keyfunc, "RS256")
	assert.NoError(t, err)
}

func TestValidateUserClaims(t *testing.T) {
	const token = "eyJ0eXAiOiJKV1QiLCJraWQiOiJmZWQ1NzhkMi0wZWI5LTRhZTQtYTI3Yy05YjQyMzA3NWUxMzIiLCJhbGciOiJFUzI1NiIsImlzcyI6Imh0dHBzOi8vY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vdXMtZWFzdC0xX3pCbWM4eXRjRyIsImNsaWVudCI6IjF0Mmk2YWRidjBzMmJmazBxZjR1cDI1aTFqIiwic2lnbmVyIjoiYXJuOmF3czplbGFzdGljbG9hZGJhbGFuY2luZzp1cy1lYXN0LTE6NTc0NTYzMjg0NDk1OmxvYWRiYWxhbmNlci9hcHAvZGVmYXVsdC80NjY5NGFlYTU3NjZhYTQyIiwiZXhwIjoxNjk5MDYzMTUxfQ.eyJzdWIiOiJhMjI5M2I0OC05NzQxLTQ1ZDYtOTE3NC03MjE3Yzk2MTMxY2IiLCJlbWFpbF92ZXJpZmllZCI6InRydWUiLCJlbWFpbCI6ImRpZWdvLnNvZ2FyaUBnbWFpbC5jb20iLCJ1c2VybmFtZSI6ImEyMjkzYjQ4LTk3NDEtNDVkNi05MTc0LTcyMTdjOTYxMzFjYiIsImV4cCI6MTY5OTA2MzE1MSwiaXNzIjoiaHR0cHM6Ly9jb2duaXRvLWlkcC51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS91cy1lYXN0LTFfekJtYzh5dGNHIn0.lhiYxUhRcf8IgNT_l3ytMbxDmTGu720JK_Z3J4Yt2NNvLxbeno9wxdcSvqvg_BBrShbj-JmRoHzQJQ1C0TsHMA"
	_, err := validateToken(token, getPublicKey, "ES256")
	assert.NoError(t, err)
}
